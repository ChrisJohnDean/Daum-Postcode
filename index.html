<!DOCTYPE html>
<html lang="ko">
    <head>
        <title>Daum Postcode Service</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
      </head>
      <body onload="execDaumPostcode()">
      <div id = "layer" style = "display:block; position:absolute; overflow:hidden; z-index:1; -webkit-overflow-scrolling:touch; ">
      </div>
                <script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>    
                <script>
                    alert("second script");
                    window.addEventListener("message", onReceivedPostMessage, false);
                    alert("second script");
                    console.log("hello world");
                    function onReceivedPostMessage(event) {
                        var action = event.data.action;
                        var params = event.data.params;
                        console.log("onReceivedPostMessage "+event);
                    }

                    function postMessageToiOS(postData) {
                        window.webkit.messageHandlers.callBackHandler.postMessage(postData);
                    }

                    var element_layer = document.getElementById('layer');
                    function execDaumPostcode() {
                        alert("alert");
                        new daum.Postcode({
                            oncomplete: function(data) {
                                alert("onComplete");
                                console.log("hello world");
                                // window.webkit.messageHandlers.callBackHandler.postMessage(data);
                                window.postMessageToiOS(data);
                            },
                            width : '100%',
                            height : '100%'
                        }).embed(element_layer);
                        element_layer.style.display = 'block';
                        initLayerPosition();
                    }

                    function initLayerPosition(){
                        var width = (window.innerWidth || document.documentElement.clientWidth);
                        var height = (window.innerHeight || document.documentElement.clientHeight);
                        element_layer.style.width = width + 'px';
                        element_layer.style.height = height + 'px';
                        element_layer.style.left = (((window.innerWidth || document.documentElement.clientWidth) - width)/2) + 'px';
                        element_layer.style.top = (((window.innerHeight || document.documentElement.clientHeight) - height)/2) + 'px';
                    }
                </script>
            </body>
</html>
